
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>HA_MVTSAF_SS22_Thi_Lan_Anh_Nguyen</title><meta name="generator" content="MATLAB 9.11"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2023-02-08"><meta name="DC.source" content="HA_MVTSAF_SS22_Thi_Lan_Anh_Nguyen.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">Multivariate Time Series Analysis and Forecasting</a></li><li><a href="#2">Part 1</a></li><li><a href="#3">Part 2</a></li><li><a href="#4">Part 3</a></li><li><a href="#5">Part 4</a></li></ul></div><h2 id="1">Multivariate Time Series Analysis and Forecasting</h2><p>Name: Thi Lan Anh Nguyen</p><pre class="codeinput"><span class="comment">% This program estimates VAR(p) models using Matlab's built-in functions to</span>
<span class="comment">% investigate the inflation dynamics in Germany and conduct an out-of-sample</span>
<span class="comment">% forecasting exercise.</span>
</pre><h2 id="2">Part 1</h2><pre class="codeinput">clear
clc

<span class="comment">% ===|Load the data set and transform the variables into stationary time series.</span>

load <span class="string">DE_macroeconomy.mat</span>
<span class="comment">% Transform to stationary TS</span>
CPI = diff(log(CPI))*100;
PROD = diff(log(PROD))*100;
ORDERS = diff(log(ORDERS))*100;
INT3M = diff(INT3M);

data = [CPI PROD ORDERS INT3M];
dates = dates(2:end);

<span class="comment">% ===| Plot the transformed (stationary) data:</span>
figure
plot(dates,data,<span class="string">'LineWidth'</span>,1)
xlabel(<span class="string">'Time'</span>)
ylabel(<span class="string">'m.o.m. percent change'</span>)
legend(VARnames{:})
</pre><img vspace="5" hspace="5" src="HA_MVTSAF_SS22_Thi_Lan_Anh_Nguyen_01.png" alt=""> <h2 id="3">Part 2</h2><p>Estimate VAR(p) models with lags ranging from p = 1 to p = 14.</p><pre class="codeinput"><span class="comment">% Set VAR parameters:</span>
T    = size(data, 1);          <span class="comment">% Number of observations</span>
K    = size(data, 2);          <span class="comment">% Number of variables</span>
pmax = 14;          <span class="comment">% Maximum lag</span>
lags = 1:pmax;          <span class="comment">% Lags of the VAR models</span>

<span class="comment">% Initialization of VAR objects:</span>
EstMdl(pmax) = varm(K, 0);
logL(pmax)   = nan();

<span class="comment">% Fit VAR models and compute information criteria:</span>
<span class="keyword">for</span> p = 1:pmax
    Mdl = varm(K, p);                       <span class="comment">% Specify VAR(p) structure</span>
    Mdl.SeriesNames = VARnames;             <span class="comment">% Define variable names</span>
    [EstMdl(p),~,logL(p)] = estimate(Mdl, data);   <span class="comment">% Estimate VAR(p) models and store results</span>
    NumParams = summarize(EstMdl(p)).NumEstimatedParameters;        <span class="comment">% Recover number of parameters for each VAR(p)</span>
    [AIC(p), BIC(p)] = aicbic(logL(p), NumParams, T-p);             <span class="comment">% Store information criteria</span>
<span class="keyword">end</span>

[~,p_hata] = min(AIC);        <span class="comment">% Best model to AIC</span>
[~,p_hatb] = min(BIC);        <span class="comment">% Best model to BIC</span>
display(p_hata)
display(p_hatb)

<span class="comment">% According to the Akaike (AIC) model with 12 lags is the best, while for</span>
<span class="comment">% Bayesian (BIC) 1-lagged model has the best fit.</span>
</pre><pre class="codeoutput">
p_hata =

    12


p_hatb =

     1

</pre><h2 id="4">Part 3</h2><pre class="codeinput"><span class="comment">%Which model would you select for impulse response analysis?</span>

<span class="comment">% ===|Store your selected model results as BestMdl.</span>
p = p_hata;                                     <span class="comment">% Try AIC model*</span>
[BestMdl,~,~,E] = estimate(varm(K, p), data);   <span class="comment">% Re-estimate and store selected model</span>
BestMdl.SeriesNames = VARnames;    <span class="comment">% Define variable names</span>

<span class="comment">% ===|Plot the estimated residuals for each equation of the BestMdl VAR(p) model in one single figure.</span>
figure
plot(dates(p+1:end),E,<span class="string">'LineWidth'</span>,1)
xlabel(<span class="string">'Time'</span>)
ylabel(<span class="string">'Estimated residuals'</span>)
legend(VARnames{:})

<span class="comment">% ===|Discuss whether serial correlation patterns emerge and decide on model</span>
<span class="comment">% rejec-tion/acceptance of BestMdl.</span>
figure
<span class="keyword">for</span> i = 1:K
    subplot(2,2,i)
    autocorr(E(:, i));
    title([VARnames{i} <span class="string">' ACF'</span>]);
<span class="keyword">end</span>
<span class="comment">% It seems like there is almost no autocorrelation in all 4 equations</span>
<span class="comment">% (except 15th lag in PROD)</span>
<span class="comment">% -&gt; the model with 12 lags mostly capture the relationship between</span>
<span class="comment">% variables =&gt; accept model with 12 lags</span>

<span class="comment">% If change p = p_hatb = 1 -&gt; the autocorrelation is still very much</span>
<span class="comment">% significant in all 4 variables =&gt; reject model with 1 lag.</span>
</pre><img vspace="5" hspace="5" src="HA_MVTSAF_SS22_Thi_Lan_Anh_Nguyen_02.png" alt=""> <img vspace="5" hspace="5" src="HA_MVTSAF_SS22_Thi_Lan_Anh_Nguyen_03.png" alt=""> <h2 id="5">Part 4</h2><pre class="codeinput"><span class="comment">%Split the data set into the in-sample period from 1991M2 to 2012M12 with</span>
<span class="comment">% T = 263 observations and the out-of-sample period from 2013M1 to 2022M3 with</span>
<span class="comment">% N = 111 observations. Generate one-step ahead out-of-sample forecasts for</span>
<span class="comment">% VAR(p) models with lags ranging from p = 1 to p = 12.</span>
<span class="comment">% Use an expanding window analysis</span>


<span class="comment">% Set parameters for the out-of-sample forecasting exercise</span>
K = size(data, 2);      <span class="comment">% Number of variables</span>
h = 1;                  <span class="comment">% One-step ahead forecast horizon</span>
T = 263;                <span class="comment">% Number of observations for the 1st expanding window</span>
N = 111;                <span class="comment">% Number of out-of-sample windows</span>
pmax = 12;              <span class="comment">% Maximum lag order</span>

<span class="comment">% Pre-allocation of forecast matrices:</span>
y_hat   = cell(N, pmax);  <span class="comment">% Cell structure to store conditional mean forecasts</span>
y_MSE   = cell(N, pmax);  <span class="comment">% Cell structure to store MSE forecast error matrices</span>
e_MSE   = cell(N, pmax);  <span class="comment">% Cell structure to store forecast errors under MSE loss</span>

<span class="comment">% Compute out-of-sample forecasts for each VAR(p) model and rolling window:</span>
<span class="keyword">for</span> p = 1:pmax
    <span class="keyword">for</span> j = 1:N
        EstMdl       = estimate(varm(K, p), data(1:T+j-1, :));              <span class="comment">% Estimate the VAR(p) with K var and lag p</span>
       [y_hat{j,p}, y_MSE{j,p}] = forecast(EstMdl, h, data(T+j-p: T+j-1, :)); <span class="comment">% Conditional mean forecasts and MSE matrix</span>
        e_MSE{j,p}   = (data(T+j, :) - y_hat{j, p}).^2;                     <span class="comment">% Forecast squared errors (MSE loss)</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">% ===| Mean of cummulative forecast errors under MSE</span>
L_MSE = reshape(mean(cell2mat(e_MSE)), [K pmax]);                  <span class="comment">% Sample mean of e_MSE for each variable k and VAR(p) model</span>
[MSEmin, pMSE] = min(L_MSE(1, :));                                  <span class="comment">% Find best prediction model for CPI -&gt; 1st row</span>

<span class="comment">% ===| Plot mean forecast errors under MSE and MAE loss:</span>
i  = 1;   <span class="comment">% Define the variable k to investigate mean forecast errors</span>
figure
h1 = plot(1:pmax,L_MSE(i,:),<span class="string">'Marker'</span>,<span class="string">'*'</span>,<span class="string">'LineWidth'</span>,1.5);
hold <span class="string">on</span>
plot(pMSE,MSEmin,<span class="string">'Marker'</span>,<span class="string">'o'</span>,<span class="string">'MarkerSize'</span>,20,<span class="string">'LineWidth'</span>,1.5);
xlabel(<span class="string">'Lags'</span>)
legend(<span class="string">'MSE'</span>,<span class="string">'Location'</span>,<span class="string">'northwest'</span>)
title([<span class="string">'Mean Squared Forecast Errors (MSFE) for '</span> VARnames{i}]);

<span class="comment">% ===| Plot out-of-sample optimal forecasts:</span>
y_hat   = reshape(cell2mat(y_hat),[N,K,pmax]);   <span class="comment">% Reshape conditional mean forecasts</span>

figure
<span class="keyword">for</span> i = 1:1
    subplot(1,1,i)
    h1 = plot(dates,data(:, i),<span class="string">'Color'</span>,<span class="string">'blue'</span>,<span class="string">'LineWidth'</span>,1.3);
    hold <span class="string">on</span>
    h2 = plot(dates(T+1:T+N),y_hat(:,i,pMSE),<span class="string">'Color'</span>,<span class="string">'red'</span>,<span class="string">'LineWidth'</span>,1);
    title([<span class="string">'Out-of-sample forecasts for '</span> VARnames{i}]);
    h = gca;
    fill([dates(T+1) h.XLim([2 2]) dates(T+1)],h.YLim([1 1 2 2]),<span class="string">'k'</span>,<span class="keyword">...</span>
    <span class="string">'FaceAlpha'</span>,0.1,<span class="string">'EdgeColor'</span>,<span class="string">'none'</span>);
    legend([h1 h2],<span class="string">'Observed Values'</span>,<span class="string">'MSE Forecasts'</span>,<span class="string">'Location'</span>,<span class="string">'northwest'</span>)
    hold <span class="string">off</span>
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="HA_MVTSAF_SS22_Thi_Lan_Anh_Nguyen_04.png" alt=""> <img vspace="5" hspace="5" src="HA_MVTSAF_SS22_Thi_Lan_Anh_Nguyen_05.png" alt=""> <p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2021b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Multivariate Time Series Analysis and Forecasting
% Name: Thi Lan Anh Nguyen

% This program estimates VAR(p) models using Matlab's built-in functions to
% investigate the inflation dynamics in Germany and conduct an out-of-sample
% forecasting exercise.
%% Part 1

clear
clc

% ===|Load the data set and transform the variables into stationary time series. 

load DE_macroeconomy.mat
% Transform to stationary TS
CPI = diff(log(CPI))*100;
PROD = diff(log(PROD))*100;
ORDERS = diff(log(ORDERS))*100;
INT3M = diff(INT3M);

data = [CPI PROD ORDERS INT3M];
dates = dates(2:end);

% ===| Plot the transformed (stationary) data:
figure
plot(dates,data,'LineWidth',1)
xlabel('Time')
ylabel('m.o.m. percent change')
legend(VARnames{:})

%% Part 2
% Estimate VAR(p) models with lags ranging from p = 1 to p = 14. 

% Set VAR parameters:
T    = size(data, 1);          % Number of observations
K    = size(data, 2);          % Number of variables
pmax = 14;          % Maximum lag
lags = 1:pmax;          % Lags of the VAR models

% Initialization of VAR objects:
EstMdl(pmax) = varm(K, 0);     
logL(pmax)   = nan();     

% Fit VAR models and compute information criteria:
for p = 1:pmax
    Mdl = varm(K, p);                       % Specify VAR(p) structure
    Mdl.SeriesNames = VARnames;             % Define variable names
    [EstMdl(p),~,logL(p)] = estimate(Mdl, data);   % Estimate VAR(p) models and store results
    NumParams = summarize(EstMdl(p)).NumEstimatedParameters;        % Recover number of parameters for each VAR(p)
    [AIC(p), BIC(p)] = aicbic(logL(p), NumParams, T-p);             % Store information criteria
end

[~,p_hata] = min(AIC);        % Best model to AIC
[~,p_hatb] = min(BIC);        % Best model to BIC
display(p_hata)
display(p_hatb)

% According to the Akaike (AIC) model with 12 lags is the best, while for
% Bayesian (BIC) 1-lagged model has the best fit.

%% Part 3
%Which model would you select for impulse response analysis?

% ===|Store your selected model results as BestMdl. 
p = p_hata;                                     % Try AIC model*
[BestMdl,~,~,E] = estimate(varm(K, p), data);   % Re-estimate and store selected model
BestMdl.SeriesNames = VARnames;    % Define variable names

% ===|Plot the estimated residuals for each equation of the BestMdl VAR(p) model in one single figure. 
figure
plot(dates(p+1:end),E,'LineWidth',1)
xlabel('Time')
ylabel('Estimated residuals')
legend(VARnames{:})

% ===|Discuss whether serial correlation patterns emerge and decide on model 
% rejec-tion/acceptance of BestMdl. 
figure
for i = 1:K
    subplot(2,2,i)
    autocorr(E(:, i));
    title([VARnames{i} ' ACF']);
end
% It seems like there is almost no autocorrelation in all 4 equations
% (except 15th lag in PROD)
% -> the model with 12 lags mostly capture the relationship between
% variables => accept model with 12 lags 

% If change p = p_hatb = 1 -> the autocorrelation is still very much
% significant in all 4 variables => reject model with 1 lag.

%% Part 4
%Split the data set into the in-sample period from 1991M2 to 2012M12 with 
% T = 263 observations and the out-of-sample period from 2013M1 to 2022M3 with 
% N = 111 observations. Generate one-step ahead out-of-sample forecasts for 
% VAR(p) models with lags ranging from p = 1 to p = 12. 
% Use an expanding window analysis


% Set parameters for the out-of-sample forecasting exercise
K = size(data, 2);      % Number of variables
h = 1;                  % One-step ahead forecast horizon
T = 263;                % Number of observations for the 1st expanding window
N = 111;                % Number of out-of-sample windows
pmax = 12;              % Maximum lag order

% Pre-allocation of forecast matrices:
y_hat   = cell(N, pmax);  % Cell structure to store conditional mean forecasts
y_MSE   = cell(N, pmax);  % Cell structure to store MSE forecast error matrices
e_MSE   = cell(N, pmax);  % Cell structure to store forecast errors under MSE loss

% Compute out-of-sample forecasts for each VAR(p) model and rolling window:
for p = 1:pmax
    for j = 1:N 
        EstMdl       = estimate(varm(K, p), data(1:T+j-1, :));              % Estimate the VAR(p) with K var and lag p
       [y_hat{j,p}, y_MSE{j,p}] = forecast(EstMdl, h, data(T+j-p: T+j-1, :)); % Conditional mean forecasts and MSE matrix
        e_MSE{j,p}   = (data(T+j, :) - y_hat{j, p}).^2;                     % Forecast squared errors (MSE loss)
    end
end

% ===| Mean of cummulative forecast errors under MSE
L_MSE = reshape(mean(cell2mat(e_MSE)), [K pmax]);                  % Sample mean of e_MSE for each variable k and VAR(p) model
[MSEmin, pMSE] = min(L_MSE(1, :));                                  % Find best prediction model for CPI -> 1st row

% ===| Plot mean forecast errors under MSE and MAE loss:
i  = 1;   % Define the variable k to investigate mean forecast errors
figure
h1 = plot(1:pmax,L_MSE(i,:),'Marker','*','LineWidth',1.5);
hold on
plot(pMSE,MSEmin,'Marker','o','MarkerSize',20,'LineWidth',1.5);
xlabel('Lags')
legend('MSE','Location','northwest')
title(['Mean Squared Forecast Errors (MSFE) for ' VARnames{i}]);

% ===| Plot out-of-sample optimal forecasts:
y_hat   = reshape(cell2mat(y_hat),[N,K,pmax]);   % Reshape conditional mean forecasts

figure
for i = 1:1
    subplot(1,1,i)
    h1 = plot(dates,data(:, i),'Color','blue','LineWidth',1.3);
    hold on
    h2 = plot(dates(T+1:T+N),y_hat(:,i,pMSE),'Color','red','LineWidth',1);
    title(['Out-of-sample forecasts for ' VARnames{i}]);
    h = gca;
    fill([dates(T+1) h.XLim([2 2]) dates(T+1)],h.YLim([1 1 2 2]),'k',...
    'FaceAlpha',0.1,'EdgeColor','none');
    legend([h1 h2],'Observed Values','MSE Forecasts','Location','northwest')
    hold off
end

##### SOURCE END #####
--></body></html>